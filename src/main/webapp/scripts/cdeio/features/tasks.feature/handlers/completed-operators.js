// Generated by CoffeeScript 1.8.0
(function() {
  define(["jquery", "cdeio/core/loader-plugin-manager"], function($, LoaderManager) {
    return {
      viewIt: function() {
        var app, grid, gridView, me, selected;
        me = this;
        grid = me.feature.views["completed-grid"].components[0];
        gridView = me.feature.views["completed-grid"];
        selected = grid.getSelected();
        app = me.feature.module.getApplication();
        if (!selected) {
          return app.info("请选择要操作的记录");
        }
        selected = selected.id;
        gridView.model.set("id", selected);
        $.when(gridView.model.fetch()).done(function() {
          return LoaderManager.invoke("view", me.feature.module, me.feature, "form:p" + selected).done(function(view) {
            view.model = gridView.model;
            return app.showDialog({
              view: view,
              title: "Task Process",
              buttons: [
                {
                  label: "Revoke",
                  status: 'disabled',
                  fn: function(btn) {
                    return me.feature.request({
                      url: "revoke/" + btn.taskId
                    }).done(function() {
                      return grid.refresh();
                    });
                  }
                }
              ]
            });
          });
        });
        return true;
      },
      selectAll: function() {
        var grid;
        grid = this.feature.views["completed-grid"].components[0];
        grid.addParam('status', null);
        return grid.refresh();
      },
      selectFinished: function() {
        var grid;
        grid = this.feature.views["completed-grid"].components[0];
        grid.addParam('status', 'finished');
        return grid.refresh();
      },
      selectUnfinished: function() {
        var grid;
        grid = this.feature.views["completed-grid"].components[0];
        grid.addParam('status', 'unfinished');
        return grid.refresh();
      }
    };
  });

}).call(this);
